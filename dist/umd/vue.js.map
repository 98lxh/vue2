{"version":3,"file":"vue.js","sources":["../../src/utils/index.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["//判断是否为一个对象\nexport function isObject(value) {\n  return typeof value === 'object' && value !== null\n}\n\n\nexport function def(data, key, value) {\n  Object.defineProperty(data, key, {\n    enumerable: false,\n    configurable: false,\n    value\n  })\n}\n","const oldArrayMethods = Array.prototype;\nexport const arrayMetods = Object.create(oldArrayMethods);\n\n\nconst methods = [\n  'push',\n  'shift',\n  'unshift',\n  'pop',\n  'splice',\n  'reverse'\n]\n\nmethods.forEach(method => {\n  arrayMetods[method] = function (...args) {\n    //调用原生的数组方法\n    const result = oldArrayMethods[method].apply(this, args)\n    let inserted;\n    let ob = this.__ob__;\n\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args;\n        break;\n      case 'splice':\n        inserted = args.slice(2)\n        break;\n      default:\n        break;\n    }\n\n    if (inserted) {\n      ob.observerArray(inserted)\n    }\n\n    return result\n  }\n})\n","\nimport { def, isObject } from \"../utils/index\";\nimport { arrayMetods } from \"./array\"\n\nfunction defineReactive(target, key, value) {\n  observe(value);\n  return Object.defineProperty(target, key, {\n    get() {\n      /**\n       * todo:依赖收集\n      */\n      return value\n    },\n    set(newValue) {\n      if (value === newValue) return\n      console.log('更新数据')\n      observe(newValue)\n      /**\n       * todo:依赖更新\n      */\n      value = newValue\n    }\n  })\n}\n\nclass Observer {\n  constructor(value) {\n    //缺点:vue2中如果层次过多，那么需要递归的解析对象属性\n    def(value, '__ob__', this);\n    if (Array.isArray(value)) {\n      //如果数组下放对象则劫持\n      value.__proto__ = arrayMetods\n      this.observerArray(value);\n    } else {\n      this.walk(value);\n    }\n  }\n\n  walk(data) {\n    Object.keys(data).forEach(key => {\n      const value = data[key]\n      defineReactive(data, key, value)\n    })\n  }\n\n  observerArray(value) {\n    value.forEach(v => {\n      observe(v)\n    })\n  }\n}\n\nexport function observe(data) {\n  if (!isObject(data)) {\n    return data\n  }\n\n  //观测数据\n  new Observer(data)\n}\n","\nimport { observe } from \"./observer/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.props) {\n    initProps(vm)\n  }\n  if (opts.methods) {\n    initMethods(vm)\n  }\n  if (opts.data) {\n    initData(vm)\n  }\n  if (opts.computed) {\n    initComputed(vm)\n  }\n  if (opts.watch) {\n    initWatch(vm)\n  }\n}\n\nfunction initProps(vm) { }\nfunction initMethods(vm) { }\nfunction initData(vm) {\n  //数据初始化\n  let data = vm.$options.data;\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data;\n  //对象劫持\n  //MVVM 数据驱动视图\n\n  observe(data);\n}\nfunction initComputed(vm) { }\nfunction initWatch(vm) { }\n","\nimport { initState } from \"./state\";\n\n//在原型添加一个init方法\nexport function initMixin(Vue) {\n  //初始化流程\n  Vue.prototype._init = function (options) {\n\n    //数据劫持\n    const vm = this;\n    vm.$options = options;\n\n    //初始化状态\n    initState(vm);\n\n    if(vm.$options.el){\n      //数据挂载到模板 \n      vm.$mount(vm.$options.el);\n    }\n  }\n\n  Vue.prototype.$mount = function(el){\n    const vm = this;\n    const options = vm.$options;\n    el = document.querySelector(el);\n    //模板转换成渲染函数\n    if(!options.render){\n        //没有render找template\n        let template = options.template;\n        if(!template && el){\n          //没有template 取el的内容作为模板\n          template = el.outerHTML\n                   \n          let render = compileToFunction(template);\n          options.render = render\n        }\n    }\n  }\n}\n","import { initMixin } from \"./init\";\n//核心\nfunction Vue(options) {\n  //进行初始化\n  this._init(options)\n\n}\n\ninitMixin(Vue)\n\nexport default Vue\n"],"names":["isObject","value","def","data","key","Object","defineProperty","enumerable","configurable","oldArrayMethods","Array","prototype","arrayMetods","create","methods","forEach","method","args","result","apply","inserted","ob","__ob__","slice","observerArray","defineReactive","target","observe","get","set","newValue","console","log","Observer","isArray","__proto__","walk","keys","v","initState","vm","opts","$options","props","initData","computed","watch","_data","call","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","template","outerHTML","compileToFunction"],"mappings":"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"}